async function fetchCryptocurrencies() {
    try {
        const response = await fetch('https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=100&page=1&sparkline=false&price_change_percentage=1h,24h,7d,1y');
        if (!response.ok) {
            throw new Error(`Error al obtener los datos de la API: ${response.statusText}`);
        }
        const data = await response.json();
        return data;
    } catch (error) {
        console.error('Error:', error);
        throw error;
    }
}

async function displayCryptocurrencies() {
    try {
        const cryptocurrencies = await fetchCryptocurrencies();
        const tbody = document.getElementById('crypto-table-body');

        cryptocurrencies.forEach(crypto => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td><img src="${crypto.image}" alt="${crypto.name}" class="crypto-icon"></td>
                <td>${crypto.name}</td>
                <td>$${crypto.current_price}</td>
                <td class="${crypto.price_change_percentage_1h_in_currency > 0 ? 'positive' : 'negative'}">${crypto.price_change_percentage_1h_in_currency ? crypto.price_change_percentage_1h_in_currency.toFixed(2) : 'N/A'}%</td>
                <td class="${crypto.price_change_percentage_24h_in_currency > 0 ? 'positive' : 'negative'}">${crypto.price_change_percentage_24h_in_currency ? crypto.price_change_percentage_24h_in_currency.toFixed(2) : 'N/A'}%</td>
                <td class="${crypto.price_change_percentage_7d_in_currency > 0 ? 'positive' : 'negative'}">${crypto.price_change_percentage_7d_in_currency ? crypto.price_change_percentage_7d_in_currency.toFixed(2) : 'N/A'}%</td>
                <td>$${crypto.market_cap.toLocaleString()}</td>
                <td>$${crypto.total_volume.toLocaleString()}</td>
                <td>${crypto.circulating_supply.toLocaleString()}</td>
            `;
            tbody.appendChild(row);
        });

        displayRecommendations(cryptocurrencies);
        addFilterFunctionality();
        addSortFunctionality();
    } catch (error) {
        console.error('Error:', error);
        const tbody = document.getElementById('crypto-table-body');
        const row = document.createElement('tr');
        row.innerHTML = `<td colspan="9">Error al obtener los datos de la API</td>`;
        tbody.appendChild(row);
    }
}

displayCryptocurrencies();
